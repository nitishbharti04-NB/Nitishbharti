<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NITI Professional Assessment</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Pinyon+Script&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { margin:0; font-family:'Montserrat', sans-serif; background:#0e0f12; color:white; }
.container { max-width:1000px; margin:36px auto; padding:18px; }
.card { background:#fff; color:#222; padding:22px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.45); }
.btn { background:linear-gradient(135deg,#003366,#00509d); color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-weight:700; }
.btn.secondary { background:#666; }
.option { display:block; background:#f8f8f8; padding:12px; margin:10px 0; border-radius:8px; color:#222; border:1px solid #eee; cursor:pointer; }
.muted { color:#666; font-size:13px; }
#timer { font-weight:700; color:#ffcc00; text-align:center; margin-bottom:12px; }
</style>
</head>
<body>
<div class="container">

<!-- ===== Landing Page ===== -->
<div id="landing">
  <div class="card">
    <h2>Welcome to NITI Assessment</h2>
    <button class="btn" onclick="showLogin()">Start</button>
  </div>
</div>

<!-- ===== Login Page ===== -->
<div id="login" style="display:none">
  <div class="card">
    <h2>Enter Your Details</h2>
    <label>Name:<br><input type="text" id="inputName"></label><br><br>
    <label>Email:<br><input type="email" id="inputEmail"></label><br><br>
    <button class="btn" onclick="continueToSubject()">Continue</button>
    <button class="btn secondary" onclick="backToLanding()">Back</button>
  </div>
</div>

<!-- ===== Subject Selection ===== -->
<div id="subject" style="display:none">
  <div class="card">
    <h2>Select Skill</h2>
    <button class="btn" onclick="startIfReady('Excel')">Excel</button>
    <button class="btn" onclick="startIfReady('Advanced Excel')">Advanced Excel</button>
    <button class="btn" onclick="startIfReady('SQL')">SQL</button>
    <button class="btn" onclick="startIfReady('Power BI')">Power BI</button>
    <button class="btn" onclick="startIfReady('Python')">Python</button>
  </div>
</div>

<!-- ===== Quiz Page ===== -->
<div id="quiz" style="display:none">
  <div class="card">
    <div id="timer">Time Left: 20:00</div>
    <div id="questionCard"></div>
  </div>
</div>

<!-- ===== Result / Certificate Page ===== -->
<div id="result" style="display:none">
  <div class="card">
    <h2>Certificate</h2>
    <p>Name: <span id="certName"></span></p>
    <p>Skill: <span id="certSkill"></span></p>
    <p>Score: <span id="certScore"></span></p>
    <p>Grade: <span id="certGrade"></span></p>
    <p>Date: <span id="certDate"></span></p>
    <p>Certificate ID: <span id="certId"></span></p>
    <button class="btn" onclick="window.location.reload()">Restart</button>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://YOUR-SERVER.com/api/questions"; // ðŸ”´ Change this
const Q_PER_TEST = 15;
const TIME_LIMIT_S = 20*60;

/* ===== STATE ===== */
let userName='', userEmail='';
let currentSegment='';
let currentTest=[];
let userResponses=[];
let currentIndex=0;
let remainingSeconds=TIME_LIMIT_S;
let timerInterval=null;

/* ===== UTILITIES ===== */
function show(id){ document.getElementById(id).style.display=''; }
function hide(id){ document.getElementById(id).style.display='none'; }
function nowISO(){ return new Date().toISOString(); }
function genCertId(){ return 'NITI-' + Math.random().toString(36).substring(2,10).toUpperCase(); }
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;"); }

/* ===== NAVIGATION ===== */
function showLogin(){ hide('landing'); show('login'); }
function backToLanding(){ hide('login'); show('landing'); }
function continueToSubject(){
  const n=document.getElementById('inputName').value.trim();
  const e=document.getElementById('inputEmail').value.trim().toLowerCase();
  if(!n || !e) return alert('Enter name and email');
  userName=n; userEmail=e;
  hide('login'); show('subject');
}

/* ===== FETCH QUESTIONS ===== */
async function fetchQuestionPoolFromServer(segment){
  const res = await fetch(`${API_URL}?segment=${encodeURIComponent(segment)}`);
  if(!res.ok) throw new Error("API failed");
  const data = await res.json();
  if(!Array.isArray(data) || data.length < Q_PER_TEST) throw new Error("Not enough questions from server");
  return data.map(q=>{
    if(!q.options.includes(q.correct)) throw new Error("Invalid question: correct not in options");
    const shuffled = shuffle(q.options);
    return {
      id: q.id,
      q: `${segment} â€” ${q.question}`,
      options: shuffled,
      _answerIndex: shuffled.indexOf(q.correct),
      correct: q.correct,
      difficulty: q.difficulty||'hard'
    };
  });
}

/* ===== START TEST ===== */
async function startIfReady(segment){
  if(!userName || !userEmail){ alert('Enter name & email first'); return; }
  currentSegment=segment;
  hide('subject'); show('quiz');
  try{
    const pool = await fetchQuestionPoolFromServer(segment);
    currentTest = shuffle(pool).slice(0,Q_PER_TEST);
  }catch(err){ alert("Failed to load questions"); console.error(err); location.reload(); return; }
  userResponses=new Array(currentTest.length).fill(null);
  currentIndex=0; remainingSeconds=TIME_LIMIT_S;
  renderQuestion(); startTimer();
}

/* ===== TIMER ===== */
function startTimer(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    remainingSeconds--;
    document.getElementById('timer').textContent =
      `Time Left: ${Math.floor(remainingSeconds/60)}:${String(remainingSeconds%60).padStart(2,'0')}`;
    if(remainingSeconds<=0){ clearInterval(timerInterval); finishTest(); }
  },1000);
}

/* ===== QUIZ RENDER ===== */
function renderQuestion(){
  const q=currentTest[currentIndex];
  const card=document.getElementById('questionCard');
  card.innerHTML=`
    <h3>Question ${currentIndex+1}/${currentTest.length}</h3>
    <p><strong>${escapeHtml(q.q)}</strong></p>
    ${q.options.map((o,i)=>`
      <label class="option">
        <input type="radio" name="opt" value="${i}" ${userResponses[currentIndex]===i?'checked':''}>
        ${escapeHtml(o)}
      </label>
    `).join('')}
    <div style="margin-top:12px;text-align:center">
      ${currentIndex>0?'<button class="btn secondary" onclick="prevQ()">Previous</button>':''}
      <button class="btn" onclick="nextQ()">${currentIndex===currentTest.length-1?'Finish':'Next'}</button>
    </div>
  `;
}
function saveAnswer(){
  const sel=document.querySelector('input[name="opt"]:checked');
  if(sel) userResponses[currentIndex]=Number(sel.value);
}
function nextQ(){ saveAnswer(); if(currentIndex<currentTest.length-1){ currentIndex++; renderQuestion(); } else finishTest(); }
function prevQ(){ saveAnswer(); if(currentIndex>0){ currentIndex--; renderQuestion(); } }

/* ===== FINISH TEST ===== */
function finishTest(){
  saveAnswer(); clearInterval(timerInterval);
  let score=0;
  currentTest.forEach((q,i)=>{ if(userResponses[i]===q._answerIndex) score++; });
  const grade = score>=12?'Excellent':score>=8?'Advanced':'Beginner';
  const certId = genCertId();
  const recs = JSON.parse(localStorage.getItem('niti_results')||'[]');
  recs.push({
    name:userName,email:userEmail,segment:currentSegment,
    score,total:currentTest.length,grade,certId,ts:nowISO()
  });
  localStorage.setItem('niti_results',JSON.stringify(recs));
  document.getElementById('certName').textContent=userName;
  document.getElementById('certSkill').textContent=currentSegment+' Test';
  document.getElementById('certScore').textContent=`${score}/${currentTest.length}`;
  document.getElementById('certGrade').textContent=grade;
  document.getElementById('certDate').textContent=new Date().toDateString();
  document.getElementById('certId').textContent=`NITI CERT - ${certId}`;
  hide('quiz'); show('result');
}
</script>
</body>
</html>
